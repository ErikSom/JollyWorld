<!DOCTYPE html>
<html lang="en">

<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121901447-2"></script>
    <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-121901447-2");</script>

    <title>JollyWorld - Face gory levels of fun. </title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3d7d1e">
    <meta name="msapplication-TileColor" content="#3d7d1e">
    <meta name="theme-color" content="#3d7d1e">

    <meta name="twitter:card" content="summary" />
    <meta property="og:title" content="JollyWorld">
    <meta property="og:site_name" content="JollyWorld">
    <meta property="og:url" content="https://jollyworld.app">
    <meta property="og:image" content="https://jollyworld.app/jollyworld-og.png">

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui, viewport-fit=cover" />
    <meta name="description" content="Create the most decapitating levels with treacherous terrain and blood-spilling obstacles for you and your friends to ride and play through." />
    <meta property="og:description" content="Create the most decapitating levels with treacherous terrain and blood-spilling obstacles for you and your friends to ride and play through.">

    <script src="//game-cdn.poki.com/scripts/v2/poki-sdk.js"></script>

    <style>
        html,
        body,
        div,
        canvas {
            margin: 0;
            padding: 0;
            display: block;
        }
        html{
            box-sizing:border-box;
        }

        body {
            background-color: #3d7d1e;
            font-family: 'Lato', 'Helvetica Neue', Arial, Helvetica, sans-serif;
            overflow:hidden;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        #preloader{
            z-index: 999;
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: all;
        }
        #preloader.hide{
            pointer-events: none;
        }
        #preloader.hide > .preloaderDoor{
            transition: transform 0.5s ease-in;
            transform:translate(0, 120%);
        }
        #preloader.hide > .preloaderDoor.upper{
            transform:translate(0, -120%);
        }
        .preloaderDoor{
            background: #3d7d1e;
            width:100%;
            height:50vh;
            position:absolute;
            top:unset;
            bottom:0;
            left:0;
            transition: transform 0.3s ease-in;
            will-change: transform;
        }
        .preloaderDoor.upper{
            top:0;
            border-bottom: 2px solid #00000060;
            box-shadow: 0px 2px 4px 0px #111;
        }
        #preloader .preloaderBar{
            width:200px;
            height:20px;
            top: 100%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 1.6px solid white;
            margin-top: 2px;
            background:#545454;
            position: absolute;
            border-radius: 10px;
        }
        .preloaderFill,  .innerBorder{
            width:100%;
            height:100%;
            border-radius: 10px;
        }
        .preloaderBar .preloaderFill{
            background-image: -webkit-gradient(linear, 0 0, 100% 100%, color-stop(.25, rgba(0, 0, 0, .2)), color-stop(.25, transparent), color-stop(.5, transparent), color-stop(.5, rgba(0, 0, 0, .2)), color-stop(.75, rgba(0, 0, 0, .2)), color-stop(.75, transparent), to(transparent) );
            background-image: -moz-linear-gradient( -45deg, rgba(0, 0, 0, .2) 25%, transparent 25%, transparent 50%, rgba(0, 0, 0, .2) 50%, rgba(0, 0, 0, .2) 75%, transparent 75%, transparent );
            animation: move 2s linear infinite;
            -webkit-animation: move 2s linear infinite;
            position:absolute;
            background-size: 50px 50px;
            background-color: #d70201;
            width: 0%;
        }
        .preloaderBar .innerBorder{
            position: absolute;
            border: 2px solid black;
        }
        .cycling{
            position:absolute;
            z-index: 1;
            transform-origin: bottom;
            transform: scale(0.6);
            left: 0;
            top: -84px;
            margin-left: -20px;
        }
        .cycling.fall{
            animation: fall linear 1s forwards;
            -webkit-animation: fall linear 1s forwards;
            will-change: left, top, transform;
        }
        .cycling-anim{
            width: 82px;
            height: 82px;
            background: url(./assets/images/misc/cycling.png) 0 0 no-repeat;
            animation: step-frame steps(7) 600ms infinite both;
            -webkit-animation: step-frame steps(7) 600ms infinite both;
        }
        .logo{
            width: 50%;
            max-width: 200px;
            height: 26vh;
            max-height: 200px;
            background-repeat: no-repeat;
            position: absolute;
            background-position: bottom;
            z-index: 1;
            filter: drop-shadow(2px 2px 2px black);
            background-size: contain;
			background-image: url(./assets/images/gui/Logo.svg);
        }
        .centered{
            top: 100%;
            left: 50%;
            transform: translate(-50%, -100%);
            margin: -60px 0 0 0;
        }
        @keyframes move{
            0% {
		       background-position: 0 0;
		    }
		    100% {
		       background-position: 50px 50px;
		    }
        }
        @-webkit-keyframes move {
		    0% {
		       background-position: 0 0;
		    }
		    100% {
		       background-position: 50px 50px;
		    }
		}
        @keyframes step-frame {
            0% {
                background-position: 0%;
            }
            100% {
                background-position: 100%;
            }
        }
        @-webkit-keyframes step-frame {
            0% {
                background-position: 0%;
            }
            100% {
                background-position: 100%;
            }
        }
        @keyframes fall {
            0% {
                left: 160px;
                top: -84px;
                transform: scale(0.6) rotate(0deg);
            }
            20% {
                left: 184px;
                top: -60px;
                transform: scale(0.6) rotate(64deg);
            }
            100%{
                left: 190px;
                top: 120vh;
                transform: scale(0.6) rotate(66deg);
            }
        }
        @-webkit-keyframes fall {
            0% {
                left: 160px;
                top: -84px;
                transform: scale(0.6) rotate(0deg);
            }
            20% {
                left: 184px;
                top: -60px;
                transform: scale(0.6) rotate(64deg);
            }
            100%{
                left: 190px;
                top: 120vh;
                transform: scale(0.6) rotate(66deg);
            }
        }


    </style>
</head>

<body>
    <script>
		(function() {
			var host = 'poki.com';
			var element = document.createElement('script');
			var firstScript = document.getElementsByTagName('script')[0];
			var url = 'https://quantcast.mgr.consensu.org'
				.concat('/choice/', 'E_PXTAq4C0D1u', '/', host, '/choice.js')
			var uspTries = 0;
			var uspTriesLimit = 3;
			element.async = true;
			element.type = 'text/javascript';
			element.src = url;

			firstScript.parentNode.insertBefore(element, firstScript);

			function makeStub() {
				var TCF_LOCATOR_NAME = '__tcfapiLocator';
				var queue = [];
				var win = window;
				var cmpFrame;

				function addFrame() {
					var doc = win.document;
					var otherCMP = !!(win.frames[TCF_LOCATOR_NAME]);

					if (!otherCMP) {
						if (doc.body) {
							var iframe = doc.createElement('iframe');

							iframe.style.cssText = 'display:none';
							iframe.name = TCF_LOCATOR_NAME;
							doc.body.appendChild(iframe);
						} else {
							setTimeout(addFrame, 5);
						}
					}
					return !otherCMP;
				}

				function tcfAPIHandler() {
					var gdprApplies;
					var args = arguments;

					if (!args.length) {
						return queue;
					} else if (args[0] === 'setGdprApplies') {
						if (
							args.length > 3 &&
							args[2] === 2 &&
							typeof args[3] === 'boolean'
						) {
							gdprApplies = args[3];
							if (typeof args[2] === 'function') {
								args[2]('set', true);
							}
						}
					} else if (args[0] === 'ping') {
						var retr = {
							gdprApplies: gdprApplies,
							cmpLoaded: false,
							cmpStatus: 'stub'
						};

						if (typeof args[2] === 'function') {
							args[2](retr);
						}
					} else {
						queue.push(args);
					}
				}

				function postMessageEventHandler(event) {
					var msgIsString = typeof event.data === 'string';
					var json = {};

					try {
						if (msgIsString) {
							json = JSON.parse(event.data);
						} else {
							json = event.data;
						}
					} catch (ignore) {}

					var payload = json.__tcfapiCall;

					if (payload) {
						window.__tcfapi(
							payload.command,
							payload.version,
							function(retValue, success) {
								var returnMsg = {
									__tcfapiReturn: {
										returnValue: retValue,
										success: success,
										callId: payload.callId
									}
								};
								if (msgIsString) {
									returnMsg = JSON.stringify(returnMsg);
								}
								event.source.postMessage(returnMsg, '*');
							},
							payload.parameter
						);
					}
				}

				while (win) {
					try {
						if (win.frames[TCF_LOCATOR_NAME]) {
							cmpFrame = win;
							break;
						}
					} catch (ignore) {}

					if (win === window.top) {
						break;
					}
					win = win.parent;
				}
				if (!cmpFrame) {
					addFrame();
					win.__tcfapi = tcfAPIHandler;
					win.addEventListener('message', postMessageEventHandler, false);
				}
			};

			makeStub();

			var uspStubFunction = function() {
				var arg = arguments;
				if (typeof window.__uspapi !== uspStubFunction) {
					setTimeout(function() {
						if (typeof window.__uspapi !== 'undefined') {
							window.__uspapi.apply(window.__uspapi, arg);
						}
					}, 500);
				}
			};

			var checkIfUspIsReady = function() {
				uspTries++;
				if (window.__uspapi === uspStubFunction && uspTries < uspTriesLimit) {
					console.warn('USP is not accessible');
				} else {
					clearInterval(uspInterval);
				}
			};

			if (typeof window.__uspapi === 'undefined') {
				window.__uspapi = uspStubFunction;
				var uspInterval = setInterval(checkIfUspIsReady, 6000);
			}
		})();
	</script>
    <script>
        {{{BLACKBOX}}}
    </script>
    <script>
        var urlParams = new URLSearchParams(window.location.search);
        var uidHash = urlParams.get('lvl');


        if(uidHash && uidHash.length===21){
			fetch('https://api.jollyworld.app/level/'+uidHash, {method: 'GET'})
			.then(result => result.json())
			.then(data => {
				if(data.error) return;
                 if(document.querySelector){
                    document.querySelector('meta[name="description"]').setAttribute("content", data.description);
                    document.querySelector('meta[property="og:description"]').setAttribute("content", data.description);
                    document.querySelector('meta[name="description"]').setAttribute("content", data.description);
                    document.title = 'JollyWorld - '+data.title;
                    document.querySelector('meta[property="og:title"]').setAttribute("content", data.title);
                    var thumb_url = 'https://static.jollyworld.app/'+data.thumb_big_md5+'.png';
                    document.querySelector('meta[property="og:image"]').setAttribute("content", thumb_url);
                 }
			});
        }
    </script>
    <div id="editor-ui-container">
        <div id="custom-gui"></div>
    </div>
    <div id="game-ui-container"></div>
    <div id="settings-ui"></div>


    <div id="preloader">
        <div class="preloaderDoor"></div>
        <div class="preloaderDoor upper">
            <div class="logo centered"></div>
            <div class="preloaderBar">
                <div class="preloaderFill"></div>
                <div class="innerBorder"></div>
                <div class="cycling">
                    <div class="cycling-anim"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const theme = localStorage.getItem('jollyWorldTheme');
        if(theme){
            const themeSettings = JSON.parse(theme);
            const preloaderDiv = document.querySelector('#preloader');
            if(themeSettings.doorColor){
                const divs = Array.prototype.slice.call(preloaderDiv.querySelectorAll('.preloaderDoor'));
                for(let j = 0; j<divs.length; j++){
                    divs[j].style.backgroundColor = themeSettings.doorColor;
                }
            }
            if(themeSettings.doorPreloaderColor){
                const preloaderFill = preloaderDiv.querySelector('.preloaderFill');
                preloaderFill.style.backgroundColor = themeSettings.doorPreloaderColor;
            }
            if(themeSettings.doorlogoURL){
                const preloaderLogo = preloaderDiv.querySelector('.logo');
                preloaderLogo.style.backgroundImage = `url(${themeSettings.doorlogoURL})`;
            }
        }
    </script>

    <canvas id="canvas" width="900" height="506" tabindex="1"></canvas>

    <script type="module">
        window.__assetHashNames = '{{{ASSET_HASH_NAMES}}}';
        var preloaderFill = document.getElementsByClassName('preloaderFill')[0];
        var cyclist = document.querySelector('.cycling')
        window.setLoaderProgress = function(percent){
                var sp = 7;
                preloaderFill.style.width = (sp+percent*(100-sp)).toFixed(2)+'%';
                cyclist.style.left = (percent*160).toFixed(2)+'px';
            }

        var gameScript = false;
        function loadJS(url, onError) {
            PokiSDK.gameLoadingStart();
            window.setLoaderProgress(0);
            if (!onError) onError = function () {};
            var xhr = new XMLHttpRequest();
            var maxProgress = .8;
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200 || xhr.status == 0) {
                        try {
                            window.setLoaderProgress(maxProgress);
                            setTimeout(function(){
                                if(window.Box2D){
                                    gameScript = xhr.responseText;
                                    eval(xhr.responseText);
                                } else {
                                    gameScript = xhr.responseText;
                                }
                            }, 1);
                        } catch (e) {
                            onError(e);
                            return;
                        }
                    } else {
                        onError(xhr.status);
                    }
                }
            }.bind(this);
            try {
                xhr.open("GET", url, true);
                xhr.send();
            } catch (e) {
                onError(e);
            }
            xhr.onprogress = function (event) {
                var percentComplete = 0;
                if (event.lengthComputable) {
                    percentComplete = event.loaded / event.total;
                } else {
                    var total = 660000*4;
                    percentComplete = event.loaded / total;
                }
                window.setLoaderProgress(Math.min(maxProgress, percentComplete * maxProgress));
            }
        }

        import Box2DFactory from './Box2D.js';
        Box2DFactory().then(Box2D => {
            window.Box2D = Box2D;
            if(gameScript){
                eval(gameScript);
                gameScript = undefined;
            }
        });

        PokiSDK.init().then(
            () => {
                loadJS('./assets/awesome-game.js');
            }
        ).catch(
            () => {
                window.dafadfgjiwrgj = true;
                loadJS('./assets/awesome-game.js');
            }
        );
    </script>

</body>

</html>
