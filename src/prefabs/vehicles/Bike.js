import * as PrefabManager from '../PrefabManager';
import * as AudioManager from '../../utils/AudioManager';
import {Humanoid} from '../humanoids/Humanoid';

import { BaseVehicle } from './BaseVehicle';

class Bike extends BaseVehicle {
    constructor(target) {
        super(target);
        this.destroyConnectedJoints = {
            head:['pedal_right_joint', 'pedal_left_joint', 'grip_right_joint', 'grip_left_joint', 'back_joint', 'neck_joint', 'sit_joint'],
            body:['pedal_right_joint', 'pedal_left_joint', 'grip_right_joint', 'grip_left_joint', 'back_joint', 'neck_joint', 'sit_joint'],
            thigh_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            thigh_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            leg_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            leg_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            feet_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            feet_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            shoulder_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            shoulder_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
            arm_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            arm_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
            hand_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            hand_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
            belly:['pedal_left_joint', 'pedal_right_joint', 'sit_joint', 'back_joint']
        }
        this.vehicleName = 'Bike';
        this.limbsObserver = [
                                [[Humanoid.BODY_PARTS.FEET_LEFT, Humanoid.BODY_PARTS.LEG_LEFT, Humanoid.BODY_PARTS.THIGH_LEFT],
                                 [Humanoid.BODY_PARTS.FEET_RIGHT, Humanoid.BODY_PARTS.LEG_RIGHT, Humanoid.BODY_PARTS.THIGH_RIGHT]
                                ]
                            ]
    }
    init() {
        super.init();
        this.desiredVehicleTorques = [100, 100];
        this.desiredVehicleSpeeds = [20, 20];
    }
    update() {
        super.update();

        const wheelRotationSpeed = Math.abs(this.lookupObject.wheel_back.GetAngularVelocity())/10;
        const pedalSpeed = Math.abs(this.lookupObject.pedal.GetAngularVelocity())/8;
        if(this.accel == 0){
            AudioManager.stopPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_pedal_loop');
            let idleVolume = Math.min(wheelRotationSpeed/15, 0.1);
            if(idleVolume< 0.002) idleVolume = 0;
            AudioManager.playPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_idle_loop', idleVolume, Math.max(0.8, wheelRotationSpeed*1.5), this.lookupObject.frame.GetPosition());
        }else{
            AudioManager.playPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_pedal_loop', 0.3, Math.max(0.8, pedalSpeed), this.lookupObject.frame.GetPosition());
            AudioManager.stopPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_idle_loop');
        }
    }
}

PrefabManager.prefabLibrary.Bike = {
    json: '{"objects":[[0,-1.4521,-0.0227,0,".character#Character , .flesh","belly",0,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[14.1815],"",[1],true,false,false,[0.5],[0.2],false,true],[0,-2.8848,3.275,0,".vehicle","wheel_back",1,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[55.3426],"",[1],true,false,false,[0.5],[0.2],false,true],[0,-0.0036,-2.094,-0.7679,".character#Character , .flesh","shoulder_left",2,["#999999"],["#000"],[0],false,true,[[{"x":-0.1849,"y":-0.8588},{"x":0.1931,"y":-0.8424},{"x":0.1109,"y":0.8506},{"x":-0.1192,"y":0.8506}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[0,-0.3332,3.5987,0,".vehicle","pedal",3,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[15.6959],"",[1],true,false,false,[0.5],[0.2],false,true],[0,0.0336,1.9545,0,".vehicle","frame",4,["#999999"],["#000"],[0],false,true,[[{"x":-1.8667,"y":-1.6667},{"x":1.9667,"y":-2.7667},{"x":3.0667,"y":1.3},{"x":-0.2333,"y":1.7667},{"x":-2.9333,"y":1.3667}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[0,3.0667,3.2455,0,".vehicle","wheel_front",5,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[54.829],"",[1],true,false,false,[0.5],[0.2],false,true],[0,1.2339,-1.4259,-1.4661,".character#Character , .flesh","arm_left",6,["#999999"],["#000"],[0],false,true,[[{"x":-0.1356,"y":-0.6862},{"x":0.1438,"y":-0.7027},{"x":0.1274,"y":0.6945},{"x":-0.1356,"y":0.6945}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[1,0.3623,-63.1461,-0.7679,"","",7,"Normal_Shoulder0000",2,0.5731,-0.1606,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,37.2669,-42.9373,-1.4661,"","",8,"Normal_Arm0000",6,0.2976,-0.8938,0,true,"#FFFFFF",1,1,1,0,0,0,true],[0,2.1345,-1.1635,-1.501,".character#Character , .flesh","hand_left",9,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[7.5126],"",[1],true,false,false,[0.5],[0.2],false,true],[1,63.5018,-33.1874,-1.501,"","",10,"Normal_Hand0000",9,1.7975,2.9104,0,true,"#FFFFFF",1,1,1,0,0,0,true],[0,-0.5151,0.7819,-0.7854,".character#Character , .flesh","thigh_left",11,["#999999"],["#000"],[0],false,true,[[{"x":-0.2024,"y":-1.0313},{"x":0.196,"y":-1.0442},{"x":0.1703,"y":1.0378},{"x":-0.1639,"y":1.0378}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[0,-0.0507,2.3508,0.4014,".character#Character , .flesh","leg_left",12,["#999999"],["#000"],[0],false,true,[[{"x":-0.1606,"y":-0.9125},{"x":0.1606,"y":-0.9253},{"x":0.0835,"y":0.9125},{"x":-0.0835,"y":0.9253}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[1,-15.4575,23.8711,-0.7854,"","",13,"Normal_Thigh0000",11,0.4132,-2.3665,0,true,"#FFFFFF",1,1,1,0,0,0,true],[0,-0.2514,3.3774,0.1047,".character#Character , .flesh","feet_left",14,["#999999"],["#000"],[0],false,true,[[{"x":-0.3532,"y":-0.2334},{"x":0.3593,"y":0},{"x":0.3593,"y":0.1229},{"x":-0.3655,"y":0.1106}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[1,-1.7043,70.4472,0.4014,"","",15,"Normal_Leg0000",12,0.1988,-3.1416,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,-6.868,99.9661,0.1047,"","",16,"Normal_Feet0000",14,1.5151,1.2143,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,-9.6395,107.9104,0,"","",17,"Bicycle_Pedals0000",3,0.3605,0.1433,0,null,"#FFFFFF",1,1,1,0,0,0,true],[1,91.9952,97.3659,0,"","",18,"Bicycle_WheelFront0000",5,0.0055,-3.1416,0,null,"#FFFFFF",1,1,1,0,0,0,true],[1,-85.9619,97.7142,0,"","",19,"Bicycle_WheelBack0000",1,0.792,0.7446,0,null,"#FFFFFF",1,1,1,0,0,0,true],[1,2.0085,38.6359,0,"","",20,"Bicycle_Body0000",4,20.025,1.5208,0,null,"#FFFFFF",1,1,1,0,0,0,true],[0,-0.1398,-4.1734,0,".character#Character , .flesh","head",21,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[30.3931],"",[1],true,false,false,[0.5],[0.2],false,true],[0,-0.8597,-1.7378,0.3491,".character#Character , .flesh","body",22,["#999999"],["#000"],[0],false,true,[[{"x":-0.5373,"y":1.2023},{"x":-0.4316,"y":-1.3697},{"x":-0.1497,"y":-1.8277},{"x":0.1321,"y":-1.7925},{"x":0.5549,"y":-1.1231},{"x":0.5549,"y":1.3081},{"x":0.0969,"y":1.8013},{"x":-0.2202,"y":1.8013}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[1,-40.0535,-8.6918,0.2,"","",23,"Normal_Belly0000",0,8.7468,1.1579,-0.2,false,"#FFFFFF",1,1,1,0,0,0,true],[1,-23.6608,-55.7164,0.3491,"","",24,"Normal_Core0000",22,4.1688,1.3835,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,-2.0802,-127.3151,0,"","",25,"Normal_Head_Idle0000",21,2.9897,0.7854,0,true,"#FFFFFF",1,1,1,0,0,0,true],[0,-0.758,1.0593,-0.6283,".character#Character , .flesh","thigh_right",26,["#999999"],["#000"],[0],false,true,[[{"x":-0.2024,"y":-1.0313},{"x":0.196,"y":-1.0442},{"x":0.1703,"y":1.0378},{"x":-0.1639,"y":1.0378}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[0,-0.3045,2.7404,0.1745,".character#Character , .flesh","leg_right",27,["#999999"],["#000"],[0],false,true,[[{"x":-0.1606,"y":-0.9125},{"x":0.1606,"y":-0.9253},{"x":0.0835,"y":0.9125},{"x":-0.0835,"y":0.9253}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[0,0.0828,-4.2689,0,".character#Character","eye_left",28,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[7.534],"",[1],true,false,false,[0.5],[0.2],false,true],[1,-22.8091,32.1873,-0.6283,"","",29,"Normal_Thigh0000",26,0.4132,-2.3665,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,-9.3311,82.1784,0.1745,"","",30,"Normal_Leg0000",27,0.1988,-3.1416,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,2.6544,-128.601,0,"","",31,"Normal_Eye0000",28,0.5612,1.2636,0,null,"#FFFFFF",1,1,1,0,0,0,true],[0,-0.2734,3.8409,0,".character#Character , .flesh","feet_right",32,["#999999"],["#000"],[0],false,true,[[{"x":-0.3532,"y":-0.2334},{"x":0.3593,"y":0},{"x":0.3593,"y":0.1229},{"x":-0.3655,"y":0.1106}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[1,-7.6735,113.8081,0,"","",33,"Normal_Feet0000",32,1.5151,1.2143,0,true,"#FFFFFF",1,1,1,0,0,0,true],[0,-0.2553,-1.9332,-0.5236,".character#Character , .flesh","shoulder_right",34,["#999999"],["#000"],[0],false,true,[[{"x":-0.1849,"y":-0.8588},{"x":0.1931,"y":-0.8424},{"x":0.1109,"y":0.8506},{"x":-0.1192,"y":0.8506}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[0,0.8034,-1.1754,-1.4835,".character#Character , .flesh","arm_right",35,["#999999"],["#000"],[0],false,true,[[{"x":-0.1356,"y":-0.6862},{"x":0.1438,"y":-0.7027},{"x":0.1274,"y":0.6945},{"x":-0.1356,"y":0.6945}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2],false,true],[0,0.8007,-4.259,0,".character#Character","eye_right",36,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[7.534],"",[1],true,false,false,[0.5],[0.2],false,true],[1,24.1894,-128.304,0,"","",37,"Normal_Eye0000",36,0.5612,1.2636,0,null,"#FFFFFF",1,1,1,0,0,0,true],[1,-7.1235,-58.1986,-0.5236,"","",38,"Normal_Shoulder0000",34,0.5731,-0.1606,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,24.3491,-35.4266,-1.4835,"","",39,"Normal_Arm0000",35,0.2976,-0.8938,0,true,"#FFFFFF",1,1,1,0,0,0,true],[0,1.6502,-1.0455,-1.7453,".character#Character , .flesh","hand_right",40,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[7.5126],"",[1],true,false,false,[0.5],[0.2],false,true],[1,49.4039,-29.5695,-1.7453,"","",41,"Normal_Hand0000",40,1.7975,2.9104,0,true,"#FFFFFF",1,1,1,0,0,0,true],[2,18.4969,-44.764,0,".character#Character","arm_left_joint",42,6,2,0,false,false,1,10,true,152,0,0,0,0,0,false],[2,57.5577,-39.3259,0,".character#Character","hand_left_joint",43,9,6,0,false,false,1,10,true,60,-60,0,0,0,0,false],[2,8.4977,44.9967,0,".character#Character","leg_left_joint",44,12,11,0,false,false,1,10,true,-10,-149,0,0,0,0,false],[2,-12.9703,95.5754,0,".character#Character","feet_left_joint",45,14,12,0,false,false,1,10,true,20,-20,0,0,0,0,false],[2,-86.4039,96.9447,0,".vehicle","engine1",46,1,4,0,false,true,100,20,false,0,0,0,0,0,0,false],[2,-10.2646,107.6945,0,".vehicle","pedal_engine",47,3,4,0,false,true,100,20,false,0,0,0,0,0,0,false],[2,91.9154,97.2138,0,".vehicle","engine2",48,5,4,0,false,true,100,20,false,0,0,0,0,0,0,false],[2,-7.6141,-97.302,0,".character#Character","head_joint",49,21,22,0,false,false,1,10,true,58,-64,0,0,0,0,false],[2,-5.3902,57.1566,0,".character#Character","leg_right_joint",50,27,26,0,false,false,1,10,true,-10,-149,0,0,0,0,false],[2,-14.4646,110.87,0,".character#Character","feet_right_joint",51,32,27,0,false,false,1,10,true,20,-20,0,0,0,0,false],[2,23.9806,-127.307,0,".character#Character","eye_right_joint",52,36,21,0,false,false,1,10,true,0,0,0,0,0,0,false],[2,5.5328,-36.5661,0,".character#Character","arm_right_joint",53,35,34,0,false,false,1,10,true,152,0,0,0,0,0,false],[2,42.1274,-34.2797,0,".character#Character","hand_right_joint",54,40,35,0,false,false,1,10,true,60,-60,0,0,0,0,false],[2,-17.3458,-75.3614,0,".character#Character","shoulder_right_joint",55,34,22,0,false,false,1,10,true,180,-19,0,0,0,0,false],[2,2.2863,-128.2994,0,".character#Character","eye_left_joint",56,28,21,0,false,false,1,10,true,0,0,0,0,0,0,false],[2,-11.8409,-79.9761,0,".character#Character","shoulder_left_joint",57,2,22,0,false,false,1,10,true,180,-19,0,0,0,0,false],[2,-10.1884,116.9451,0,".character#Character","pedal_right_joint",58,32,3,0,false,false,1,10,false,0,0,0,0,0,0,false],[2,-9.6852,103.4338,0,".character#Character","pedal_left_joint",59,14,3,0,false,false,1,10,false,0,0,0,0,0,0,false],[2,65.289,-34.9129,0,".character#Character","grip_left_joint",60,4,9,0,false,false,1,10,false,0,0,0,0,0,0,false],[2,52.5565,-29.3002,0,".character#Character","grip_right_joint",61,4,40,0,false,false,1,10,false,0,0,0,0,0,0,false],[2,-39.0746,-107.0921,0,".character#Character","neck_joint",62,22,21,2,false,false,1,10,false,0,0,0.25,3,0,0,false],[2,-94.9754,-144.0336,0,".character#Character","back_joint",63,4,22,2,false,false,1,10,false,0,0,0.25,4,0,0,false],[2,-41.6261,-6.4321,0,".character#Character","belly_joint",64,22,0,0,false,false,1,10,true,10,-10,0,0,0,0,false],[2,-45.8671,5.8667,0,".character#Character","sit_joint",65,4,0,2,false,false,1,10,false,0,0,0.5,10,0,0,false],[2,-40.3538,5.8667,0,".character#Character","thigh_right_joint",66,26,0,0,false,false,1,10,true,142,-16,0,0,0,0,false],[2,-35.2646,1.6258,0,".character#Character","thigh_left_joint",67,11,0,0,false,false,1,10,true,142,-16,0,0,0,0,false]]}',
    class: Bike,
    library: PrefabManager.LIBRARY_ADMIN,
}
