import * as PrefabManager from '../PrefabManager';
import * as AudioManager from '../../utils/AudioManager';
import {Humanoid} from '../humanoids/Humanoid';

import { BaseVehicle } from './BaseVehicle';

class Bike extends BaseVehicle {
    constructor(target) {
        super(target);
        this.destroyConnectedJoints = {
            head:['pedal_right_joint', 'pedal_left_joint', 'grip_right_joint', 'grip_left_joint', 'back_joint', 'neck_joint', 'sit_joint'],
            body:['pedal_right_joint', 'pedal_left_joint', 'grip_right_joint', 'grip_left_joint', 'back_joint', 'neck_joint', 'sit_joint'],
            thigh_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            thigh_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            leg_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            leg_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            feet_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            feet_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            shoulder_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            shoulder_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
            arm_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            arm_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
            hand_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            hand_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
            belly:['pedal_left_joint', 'pedal_right_joint', 'sit_joint', 'back_joint']
        }
        this.vehicleName = 'Bike';
        this.limbsObserver = [
                                [[Humanoid.BODY_PARTS.FEET_LEFT, Humanoid.BODY_PARTS.LEG_LEFT, Humanoid.BODY_PARTS.THIGH_LEFT],
                                 [Humanoid.BODY_PARTS.FEET_RIGHT, Humanoid.BODY_PARTS.LEG_RIGHT, Humanoid.BODY_PARTS.THIGH_RIGHT]
                                ]
                            ]
    }
    init() {
        super.init();
        this.desiredVehicleTorques = [100, 100];
        this.desiredVehicleSpeeds = [20, 20];
    }
    update() {
        super.update();

        const wheelRotationSpeed = Math.abs(this.lookupObject.wheel_back.GetAngularVelocity())/10;
        const pedalSpeed = Math.abs(this.lookupObject.pedal.GetAngularVelocity())/8;
        if(this.accel == 0){
            AudioManager.stopPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_pedal_loop');
            let idleVolume = Math.min(wheelRotationSpeed/15, 0.1);
            if(idleVolume< 0.002) idleVolume = 0;
            AudioManager.playPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_idle_loop', idleVolume, Math.max(0.8, wheelRotationSpeed*1.5), this.lookupObject.frame.GetPosition());
        }else{
            AudioManager.playPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_pedal_loop', 0.3, Math.max(0.8, pedalSpeed), this.lookupObject.frame.GetPosition());
            AudioManager.stopPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_idle_loop');
        }
    }
    destroy(){
        AudioManager.stopPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_pedal_loop');
        AudioManager.stopPrefabUniqueLoopSFX(this.prefabObject.key, 'bike_idle_loop');
        super.destroy();
    }
}

PrefabManager.prefabLibrary.Bike = {
    json: '{"objects":[[0,-1.4477,-0.0227,0,".character#Character , .flesh","belly",0,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[14.1815],"",[1],true,false,false,[0.5],[0.2]],[0,-2.8804,3.275,0,".vehicle","wheel_back",1,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[55.3426],"",[1],true,false,false,[0.5],[0.2]],[0,0.0008,-2.094,-0.7679,".character#Character , .flesh","shoulder_left",2,["#999999"],["#000"],[0],false,true,[[{"x":-0.1849,"y":-0.8588},{"x":0.1931,"y":-0.8424},{"x":0.1109,"y":0.8506},{"x":-0.1192,"y":0.8506}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[0,-0.3288,3.5987,0,".vehicle","pedal",3,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[15.6959],"",[1],true,false,false,[0.5],[0.2]],[0,0.038,1.9545,0,".vehicle","frame",4,["#999999"],["#000"],[0],false,true,[[{"x":-1.8667,"y":-1.6667},{"x":1.9667,"y":-2.7667},{"x":3.0667,"y":1.3},{"x":-0.2333,"y":1.7667},{"x":-2.9333,"y":1.3667}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[0,3.0711,3.2455,0,".vehicle","wheel_front",5,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[54.829],"",[1],true,false,false,[0.5],[0.2]],[0,1.2383,-1.4259,-1.4661,".character#Character , .flesh","arm_left",6,["#999999"],["#000"],[0],false,true,[[{"x":-0.1356,"y":-0.6862},{"x":0.1438,"y":-0.7027},{"x":0.1274,"y":0.6945},{"x":-0.1356,"y":0.6945}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[1,0.4948,-63.1455,-0.7679,"","",7,"Normal_Shoulder0000",2,0.5731,-0.1606,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,37.3994,-42.9367,-1.4661,"","",8,"Normal_Arm0000",6,0.2976,-0.8938,0,true,"#FFFFFF",1,1,1,0,0,0,true],[2,18.6292,-44.7649,0,".character#Character","arm_left_joint",9,6,2,0,false,false,1,10,true,152,0,0,0,0,0,false],[0,2.1389,-1.1635,-1.501,".character#Character , .flesh","hand_left",10,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[7.5126],"",[1],true,false,false,[0.5],[0.2]],[1,63.6343,-33.1868,-1.501,"","",11,"Normal_Hand0000",10,1.7975,2.9104,0,true,"#FFFFFF",1,1,1,0,0,0,true],[2,57.69,-39.3268,0,".character#Character","hand_left_joint",12,10,6,0,false,false,1,10,true,60,-60,0,0,0,0,false],[0,-0.5107,0.7819,-0.7854,".character#Character , .flesh","thigh_left",13,["#999999"],["#000"],[0],false,true,[[{"x":-0.2024,"y":-1.0313},{"x":0.196,"y":-1.0442},{"x":0.1703,"y":1.0378},{"x":-0.1639,"y":1.0378}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[0,-0.0463,2.3508,0.4014,".character#Character , .flesh","leg_left",14,["#999999"],["#000"],[0],false,true,[[{"x":-0.1606,"y":-0.9125},{"x":0.1606,"y":-0.9253},{"x":0.0835,"y":0.9125},{"x":-0.0835,"y":0.9253}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[1,-15.3251,23.8717,-0.7854,"","",15,"Normal_Thigh0000",13,0.4132,-2.3665,0,true,"#FFFFFF",1,1,1,0,0,0,true],[0,-0.247,3.3774,0.1047,".character#Character , .flesh","feet_left",16,["#999999"],["#000"],[0],false,true,[[{"x":-0.3532,"y":-0.2334},{"x":0.3593,"y":0},{"x":0.3593,"y":0.1229},{"x":-0.3655,"y":0.1106}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[1,-1.5718,70.4478,0.4014,"","",17,"Normal_Leg0000",14,0.1988,-3.1416,0,true,"#FFFFFF",1,1,1,0,0,0,true],[2,8.63,44.9958,0,".character#Character","leg_left_joint",18,14,13,0,false,false,1,10,true,-10,-149,0,0,0,0,false],[1,-6.7356,99.9667,0.1047,"","",19,"Normal_Feet0000",16,1.5151,1.2143,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,-9.507,107.911,0,"","",20,"Bicycle_Pedals0000",3,0.3605,0.1433,0,null,"#FFFFFF",1,1,1,0,0,0,true],[1,92.1277,97.3665,0,"","",21,"Bicycle_WheelFront0000",5,0.0055,-3.1416,0,null,"#FFFFFF",1,1,1,0,0,0,true],[1,-85.8294,97.7148,0,"","",22,"Bicycle_WheelBack0000",1,0.792,0.7446,0,null,"#FFFFFF",1,1,1,0,0,0,true],[1,2.141,38.6365,0,"","",23,"Bicycle_Body0000",4,20.025,1.5208,0,null,"#FFFFFF",1,1,1,0,0,0,true],[2,-12.838,95.5745,0,".character#Character","feet_left_joint",24,16,14,0,false,false,1,10,true,20,-20,0,0,0,0,false],[2,-86.2716,96.9438,0,".vehicle","engine1",25,1,4,0,false,true,100,20,false,0,0,0,0,0,0,false],[2,-10.1323,107.6936,0,".vehicle","pedal_engine",26,3,4,0,false,true,100,20,false,0,0,0,0,0,0,false],[2,92.0477,97.2129,0,".vehicle","engine2",27,5,4,0,false,true,100,20,false,0,0,0,0,0,0,false],[0,-0.1354,-4.1734,0,".character#Character , .flesh","head",28,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[30.3931],"",[1],true,false,false,[0.5],[0.2]],[0,-0.8553,-1.7378,0.3491,".character#Character , .flesh","body",29,["#999999"],["#000"],[0],false,true,[[{"x":-0.5373,"y":1.2023},{"x":-0.4316,"y":-1.3697},{"x":-0.1497,"y":-1.8277},{"x":0.1321,"y":-1.7925},{"x":0.5549,"y":-1.1231},{"x":0.5549,"y":1.3081},{"x":0.0969,"y":1.8013},{"x":-0.2202,"y":1.8013}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[1,-39.921,-8.6912,0.2,"","",30,"Normal_Belly0000",0,8.7468,1.1579,-0.2,false,"#FFFFFF",1,1,1,0,0,0,true],[1,-23.5284,-55.7158,0.3491,"","",31,"Normal_Core0000",29,4.1688,1.3835,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,-1.9478,-127.3145,0,"","",32,"Normal_Head_Idle0000",28,2.9897,0.7854,0,true,"#FFFFFF",1,1,1,0,0,0,true],[2,-7.4818,-97.3029,0,".character#Character","head_joint",33,28,29,0,false,false,1,10,true,58,-64,0,0,0,0,false],[0,-0.7536,1.0593,-0.6283,".character#Character , .flesh","thigh_right",34,["#999999"],["#000"],[0],false,true,[[{"x":-0.2024,"y":-1.0313},{"x":0.196,"y":-1.0442},{"x":0.1703,"y":1.0378},{"x":-0.1639,"y":1.0378}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[0,-0.3001,2.7404,0.1745,".character#Character , .flesh","leg_right",35,["#999999"],["#000"],[0],false,true,[[{"x":-0.1606,"y":-0.9125},{"x":0.1606,"y":-0.9253},{"x":0.0835,"y":0.9125},{"x":-0.0835,"y":0.9253}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[0,0.0902,-4.2689,0,".character#Character","eye_left",36,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[7.534],"",[1],true,false,false,[0.5],[0.2]],[1,-22.6766,32.1879,-0.6283,"","",37,"Normal_Thigh0000",34,0.4132,-2.3665,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,-9.1986,82.179,0.1745,"","",38,"Normal_Leg0000",35,0.1988,-3.1416,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,1.7869,-128.6004,0,"","",39,"Normal_Eye0000",36,0.5612,1.2636,0,null,"#FFFFFF",1,1,1,0,0,0,true],[2,-5.2579,57.1557,0,".character#Character","leg_right_joint",40,35,34,0,false,false,1,10,true,-10,-149,0,0,0,0,false],[0,-0.269,3.8409,0,".character#Character , .flesh","feet_right",41,["#999999"],["#000"],[0],false,true,[[{"x":-0.3532,"y":-0.2334},{"x":0.3593,"y":0},{"x":0.3593,"y":0.1229},{"x":-0.3655,"y":0.1106}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[1,-7.541,113.8087,0,"","",42,"Normal_Feet0000",41,1.5151,1.2143,0,true,"#FFFFFF",1,1,1,0,0,0,true],[2,-14.3323,110.8691,0,".character#Character","feet_right_joint",43,41,35,0,false,false,1,10,true,20,-20,0,0,0,0,false],[0,-0.2509,-1.9332,-0.5236,".character#Character , .flesh","shoulder_right",44,["#999999"],["#000"],[0],false,true,[[{"x":-0.1849,"y":-0.8588},{"x":0.1931,"y":-0.8424},{"x":0.1109,"y":0.8506},{"x":-0.1192,"y":0.8506}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[0,0.8078,-1.1754,-1.4835,".character#Character , .flesh","arm_right",45,["#999999"],["#000"],[0],false,true,[[{"x":-0.1356,"y":-0.6862},{"x":0.1438,"y":-0.7027},{"x":0.1274,"y":0.6945},{"x":-0.1356,"y":0.6945}]],[1],[7],[null],"",[1],true,false,false,[0.5],[0.2]],[0,0.8044,-4.259,0,".character#Character","eye_right",46,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[7.534],"",[1],true,false,false,[0.5],[0.2]],[1,22.3219,-128.3034,0,"","",47,"Normal_Eye0000",46,0.5612,1.2636,0,null,"#FFFFFF",1,1,1,0,0,0,true],[2,22.1129,-127.3079,0,".character#Character","eye_right_joint",48,46,28,0,false,false,1,10,true,0,0,0,0,0,0,false],[1,-6.991,-58.198,-0.5236,"","",49,"Normal_Shoulder0000",44,0.5731,-0.1606,0,true,"#FFFFFF",1,1,1,0,0,0,true],[1,24.4815,-35.426,-1.4835,"","",50,"Normal_Arm0000",45,0.2976,-0.8938,0,true,"#FFFFFF",1,1,1,0,0,0,true],[2,5.6651,-36.567,0,".character#Character","arm_right_joint",51,45,44,0,false,false,1,10,true,152,0,0,0,0,0,false],[0,1.6546,-1.0455,-1.7453,".character#Character , .flesh","hand_right",52,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],[7],[7.5126],"",[1],true,false,false,[0.5],[0.2]],[1,49.5364,-29.5689,-1.7453,"","",53,"Normal_Hand0000",52,1.7975,2.9104,0,true,"#FFFFFF",1,1,1,0,0,0,true],[2,42.2597,-34.2806,0,".character#Character","hand_right_joint",54,52,45,0,false,false,1,10,true,60,-60,0,0,0,0,false],[2,-17.2135,-75.3623,0,".character#Character","shoulder_right_joint",55,44,29,0,false,false,1,10,true,180,-19,0,0,0,0,false],[2,1.4186,-128.3003,0,".character#Character","eye_left_joint",56,36,28,0,false,false,1,10,true,0,0,0,0,0,0,false],[2,-11.7086,-79.977,0,".character#Character","shoulder_left_joint",57,2,29,0,false,false,1,10,true,180,-19,0,0,0,0,false],[2,-10.0561,116.9442,0,".character#Character","pedal_right_joint",58,41,3,0,false,false,1,10,false,0,0,0,0,0,0,false],[2,-9.5529,103.4329,0,".character#Character","pedal_left_joint",59,16,3,0,false,false,1,10,false,0,0,0,0,0,0,false],[2,65.4213,-34.9138,0,".character#Character","grip_left_joint",60,4,10,0,false,false,1,10,false,0,0,0,0,0,0,false],[2,52.6888,-29.3011,0,".character#Character","grip_right_joint",61,4,52,0,false,false,1,10,false,0,0,0,0,0,0,false],[2,-38.9423,-107.093,0,".character#Character","neck_joint",62,29,28,2,false,false,1,10,false,0,0,0.25,3,0,0,false],[2,-94.8431,-144.0345,0,".character#Character","back_joint",63,4,29,2,false,false,1,10,false,0,0,0.25,4,0,0,false],[2,-41.4938,-6.433,0,".character#Character","belly_joint",64,29,0,0,false,false,1,10,true,10,-10,0,0,0,0,false],[2,-45.7348,5.8658,0,".character#Character","sit_joint",65,4,0,2,false,false,1,10,false,0,0,0.5,10,0,0,false],[2,-40.2215,5.8658,0,".character#Character","thigh_right_joint",66,34,0,0,false,false,1,10,true,142,-16,0,0,0,0,false],[2,-35.1323,1.6249,0,".character#Character","thigh_left_joint",67,13,0,0,false,false,1,10,true,142,-16,0,0,0,0,false]]}',
    class: Bike,
    library: PrefabManager.LIBRARY_ADMIN,
}
