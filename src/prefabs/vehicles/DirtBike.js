import * as PrefabManager from '../PrefabManager';
import * as AudioManager from '../../utils/AudioManager';

import { BaseVehicle } from './BaseVehicle';
import { DirtBikeHelmet } from '../hats/dirtBikeHelmet'

import {
    game
} from "../../Game";

class DirtBike extends BaseVehicle {
    constructor(target) {
        super(target);
        this.destroyConnectedJoints = {
            head:['pedal_right_joint', 'pedal_left_joint', 'grip_right_joint', 'grip_left_joint', 'back_joint', 'neck_joint', 'sit_joint'],
            body:['pedal_right_joint', 'pedal_left_joint', 'grip_right_joint', 'grip_left_joint', 'back_joint', 'neck_joint', 'sit_joint'],
            thigh_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            thigh_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            leg_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            leg_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            feet_left:['pedal_left_joint', {ifno:'pedal_right_joint', destroy:['sit_joint', 'back_joint']}],
            feet_right:['pedal_right_joint', {ifno:'pedal_left_joint', destroy:['sit_joint', 'back_joint']}],
            shoulder_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            shoulder_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
            arm_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            arm_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
            hand_left:['grip_left_joint', {ifno:'grip_right_joint', destroy:['back_joint']}],
            hand_right:['grip_right_joint', {ifno:'grip_left_joint', destroy:['back_joint']}],
        }
        this.vehicleName = 'DirtBike';
    }
    init() {
        super.init();
        this.desiredVehicleTorques = [20000, 20000];
        this.desiredVehicleSpeeds = [20, 20];

        this.character.setHat(DirtBikeHelmet);

        this.refAccel = 0;
    }
    update() {
        super.update();

        const wheelRotationSpeed = Math.abs(this.lookupObject.wheel_back.GetAngularVelocity())/20;

        this.airOffset = this.grounded ? 0 : 0.2;

        if(this.accel == 0){
            this.refAccel = Math.max(0, this.refAccel - (game.editor.deltaTime / 500));
            AudioManager.playPrefabUniqueLoopSFX(this.prefabObject.key, 'dirtbike_gas_loop', 0.25 * this.refAccel+0.05, Math.max(0.6, wheelRotationSpeed *.8 * this.refAccel)+this.airOffset);
        }else{
            AudioManager.playPrefabUniqueLoopSFX(this.prefabObject.key, 'dirtbike_gas_loop', 0.3, Math.max(0.6, wheelRotationSpeed)+this.airOffset);
            this.refAccel = 1.0;
        }

    }

    accelerate(dir){
        super.accelerate(dir);
    }
    stopAccelerate(){
        super.stopAccelerate();
    }
}

PrefabManager.prefabLibrary.DirtBike = {
    json: '{"objects":[[0,-4.255789926267525,2.656607136535347,0,".vehicle","wheel_back",0,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],7,[60.00000000000001],"",[1]],[0,3.8329218328652024,2.661339254287325,0,".vehicle","wheel_front",1,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],7,[60.00000000000001],"",[1]],[0,-0.5734568052495412,-0.4761260069480946,-0.8203047484373356,".character#Character , .flesh","thigh_left",2,["#999999"],["#000"],[0],false,true,[[{"x":-0.20241022695050503,"y":-1.031328299223996},{"x":0.1959845054600109,"y":-1.0441797422049808},{"x":0.17028161949803788,"y":1.0377540207144893},{"x":-0.16385589800755085,"y":1.0377540207144893}]],[1],7,[null],"",[1]],[0,0.14396643354444771,1.1987268811626164,0.03490658503988578,".character#Character , .flesh","leg_left",3,["#999999"],["#000"],[0],false,true,[[{"x":-0.16064303726230378,"y":-0.9124524516498909},{"x":0.16064303726230378,"y":-0.9253038946308756},{"x":0.08353437937639896,"y":0.9124524516498909},{"x":-0.08353437937639896,"y":0.9253038946308738}]],[1],7,[null],"",[1]],[1,-17.193541127734104,-13.870693148207726,-0.8203047484373356,"","",4,"Normal_Thigh0000",2,0.4132120599733628,-2.3665034033387577,0,true,"#FFFFFF",1,1,1,0,0,0],[1,4.120318348725785,35.95486856295649,0.03490658503988578,"","",5,"Normal_Leg0000",3,0.19879575861250487,-3.1415926535889356,0,true,"#FFFFFF",1,1,1,0,0,0],[2,5.640906067555445,6.464690457452551,0,".character#Character","leg_left_joint",6,3,2,0,false,false,1,10,true,0,-149,0,0,0,0],[0,0.36763041021442044,0.35721861614465206,0,".vehicle","frame",7,["#999999"],["#000"],[0],false,true,[[[{"x":-5.572978827253469,"y":-1.4820299087181414},{"x":-1.2703113503298349,"y":2.3084152495241064},{"x":0.539540842344393,"y":2.3084152495241064},{"x":4.671467546374229,"y":-0.2526963438828176},{"x":1.4615410159708833,"y":-2.882104246447261}]]],[1],7,[0],"",[1]],[1,-127.67369778802575,79.69821409606041,0,"","",8,"DirtBike_WheelBack0000",0,0,0,0,false,"#FFFFFF",1,1,1,0,0,0],[0,3.6296393449321727,1.7334804637535797,0,".vehicle","front_axis",9,["#999999"],["#000"],[0],false,true,[[[{"x":-0.6280654002153891,"y":-1.0694142150102763},{"x":0.44270553657403156,"y":1.177696624167524},{"x":0.6236809061722433,"y":1.072127658568565},{"x":-0.4383210425308839,"y":-1.1804100677258171}]]],[100],7,[0],"",[1]],[0,-3.1468865420617353,2.361599735033271,0,".vehicle","back_axis",10,["#999999"],["#000"],[0],false,true,[[[{"x":-2.1984501919656,"y":0.7871870042199411},{"x":2.226817291216772,"y":-0.3191298665756519},{"x":2.236272990967162,"y":-0.7919148540951357},{"x":-2.264640090218327,"y":0.3238577164508474}]]],[1],7,[0],"",[1]],[1,114.98765498595607,79.84017762861977,0,"","",11,"DirtBike_WheelFront0000",1,2.6645352591003757e-14,-1.5707963267948966,0,false,"#FFFFFF",1,1,1,0,0,0],[1,108.63334445704095,51.6104250258187,0,"","",12,"DirtBike_Axis0000",9,0.46976509661530524,2.146713054392493,0,false,"#FFFFFF",1,1,1,0,0,0],[1,-94.22141050688813,71.13865162761584,0,"","",13,"DirtBike_WheelSupport0000",10,0.3446400344143832,-1.0035271653506954,0,false,"#FFFFFF",1,1,1,0,0,0],[0,-0.05419839495810952,-3.223277349510778,-0.7679448708775047,".character#Character , .flesh","shoulder_left",14,["#999999"],["#000"],[0],false,true,[[{"x":-0.18491373990083915,"y":-0.8588215919838902},{"x":0.19313212834087423,"y":-0.8423848151038147},{"x":0.11094824394050207,"y":0.8506032035438524},{"x":-0.11916663238053715,"y":0.8506032035438524}]],[1],7,[null],"",[1]],[0,1.183217620121362,-2.5551718930322758,-1.4660765716752366,".character#Character , .flesh","arm_left",15,["#999999"],["#000"],[0],false,true,[[{"x":-0.13560340926061798,"y":-0.6862354347431072},{"x":0.14382179770064596,"y":-0.7026722116231809},{"x":0.12738502082057224,"y":0.6944538231831459},{"x":-0.13560340926061798,"y":0.6944538231831459}]],[1],7,[null],"",[1]],[1,-1.1553302310833806,-97.02536927253738,-0.7679448708775047,"","",16,"Normal_Shoulder0000",14,0.5731017503262358,-0.16063012257496162,0,true,"#FFFFFF",1,1,1,0,0,0],[1,35.74670967514625,-76.8163370393794,-1.4660765716752366,"","",17,"Normal_Arm0000",15,0.29760652045521085,-0.8937510689744023,0,true,"#FFFFFF",1,1,1,0,0,0],[2,16.97722784672966,-78.64613043033641,0,".character#Character","arm_left_joint",18,15,14,0,false,false,1,10,true,152,0,0,0,0,0],[0,2.0838532287940987,-2.2928057384476297,-1.5009831567151235,".character#Character , .flesh","hand_left",19,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],7,[7.512582183874799],"",[1]],[1,61.98268194011357,-67.06746762154069,-1.5009831567151235,"","",20,"Normal_Hand0000",19,1.7975185021906417,2.9104087855451417,0,true,"#FFFFFF",1,1,1,0,0,0],[2,56.03803567840492,-73.20804580321062,0,".character#Character","hand_left_joint",21,19,15,0,false,false,1,10,true,60,-60,0,0,0,0],[0,0.3304712811409136,2.294944535433116,0.017453292519943136,".character#Character , .flesh","feet_left",22,["#999999"],["#000"],[0],false,true,[[{"x":-0.3532003169100655,"y":-0.2334193398709985},{"x":0.3593429311171974,"y":0},{"x":0.3593429311171974,"y":0.12285228414263472},{"x":-0.3654855453243293,"y":0.11056705572837089}]],[1],7,[null],"",[1]],[1,10.467600231420093,67.43798383115497,0.017453292519943136,"","",23,"Normal_Feet0000",22,1.515062169946712,1.2142877670861258,0,true,"#FFFFFF",1,1,1,0,0,0],[2,4.168158828216461,60.730156278170014,0,".character#Character","feet_left_joint",24,22,3,0,false,false,1,10,true,0,0,0,0,0,0],[1,-3.687406212451677,1.999740342072883,0,"","",25,"DirtBike_Body0000",7,17.104179292635067,2.60683691759783,0,false,"#FFFFFF",1,1,1,0,0,0],[0,-1.6027719112848517,-1.3186649099187964,0,".character#Character , .flesh","belly",26,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],7,[14.181497764354457],"",[1]],[0,-0.19044672516783945,-5.302664141118985,0,".character#Character , .flesh","head",27,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],7,[30.393075689479595],"",[1]],[0,-1.0103201270412148,-3.0337560242779116,0.3490658503988659,".character#Character , .flesh","body",28,["#999999"],["#000"],[0],false,true,[[{"x":-0.5373137876370677,"y":1.2023497051222813},{"x":-0.4316127146592841,"y":-1.3697097373371037},{"x":-0.1497431867185277,"y":-1.82774772024083},{"x":0.1321263412222251,"y":-1.7925140292482356},{"x":0.5549306331333597,"y":-1.1230739003889436},{"x":0.5549306331333597,"y":1.308050778100065},{"x":0.09689265022963056,"y":1.801322451996385},{"x":-0.2202105687037168,"y":1.801322451996385}]],[1],7,[null],"",[1]],[1,-44.57350667118205,-47.571709792595485,0.2,"","",29,"Normal_Belly0000",26,8.746770037203438,1.1579140652818587,-0.2,false,"#FFFFFF",1,1,1,0,0,0],[1,-28.17928871755105,-94.596092824733,0.3490658503988659,"","",30,"Normal_Core0000",28,4.16882293351236,1.3835014335302833,0,true,"#FFFFFF",1,1,1,0,0,0],[1,-3.5993802954802643,-161.19394569312522,0,"","",31,"Normal_Head_Idle0000",27,2.989677819250855,0.785398163397623,0,true,"#FFFFFF",1,1,1,0,0,0],[2,-9.133776136335204,-131.184115735656,0,".character#Character","head_joint",32,27,28,0,false,false,1,10,true,58,-64,0,0,0,0],[0,-0.7191728306417453,-0.3568103513214871,-0.8377580409572786,".character#Character , .flesh","thigh_right",33,["#999999"],["#000"],[0],false,true,[[{"x":-0.20241022695050503,"y":-1.031328299223996},{"x":0.1959845054600109,"y":-1.0441797422049808},{"x":0.17028161949803788,"y":1.0377540207144893},{"x":-0.16385589800755085,"y":1.0377540207144893}]],[1],7,[null],"",[1]],[0,-0.0997245928497762,1.1865073828186121,0.24434609527920612,".character#Character , .flesh","leg_right",34,["#999999"],["#000"],[0],false,true,[[{"x":-0.16064303726230378,"y":-0.9124524516498909},{"x":0.16064303726230378,"y":-0.9253038946308756},{"x":0.08353437937639896,"y":0.9124524516498909},{"x":-0.08353437937639896,"y":0.9253038946308738}]],[1],7,[null],"",[1]],[0,-0.0011152754168677337,-5.398209689980536,0,".character#Character","eye_left",35,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],7,[7.534037070968986],"",[1]],[1,-21.55781407410968,-10.291463763895475,-0.8377580409572786,"","",36,"Normal_Thigh0000",33,0.4132120599733628,-2.3665034033387577,0,true,"#FFFFFF",1,1,1,0,0,0],[1,-3.1846284604768353,35.54712843779782,0.24434609527920612,"","",37,"Normal_Leg0000",34,0.19879575861250487,-3.1415926535889356,0,true,"#FFFFFF",1,1,1,0,0,0],[1,0.13622573768856083,-162.4811728331662,0,"","",38,"Normal_Eye0000",35,0.5611519909321366,1.2636024235635333,0,null,"#FFFFFF",1,1,1,0,0,0],[2,3.5356029257903323,11.793420341710968,0,".character#Character","leg_right_joint",39,34,33,0,false,false,1,10,true,0,-149,0,0,0,0],[0,-0.13175993412826437,2.3125655639808165,0,".character#Character , .flesh","feet_right",40,["#999999"],["#000"],[0],false,true,[[{"x":-0.3532003169100655,"y":-0.2334193398709985},{"x":0.3593429311171974,"y":0},{"x":0.3593429311171974,"y":0.12285228414263472},{"x":-0.3654855453243293,"y":0.11056705572837089}]],[1],7,[null],"",[1]],[1,-3.4240345619374875,67.95717025082996,0,"","",41,"Normal_Feet0000",40,1.515062169946712,1.2142877670861258,0,true,"#FFFFFF",1,1,1,0,0,0],[2,-36.78432640574344,-32.25633777105319,0,".character#Character","thigh_left_joint",42,2,26,0,false,false,1,10,true,142,-16,0,0,0,0],[2,-10.372896445191486,62.06509971117353,0,".character#Character","feet_right_joint",43,40,34,0,false,false,1,10,true,0,0,0,0,0,0],[0,-0.30596177105310685,-3.062459534773179,-0.5235987755982988,".character#Character , .flesh","shoulder_right",44,["#999999"],["#000"],[0],false,true,[[{"x":-0.18491373990083915,"y":-0.8588215919838902},{"x":0.19313212834087423,"y":-0.8423848151038147},{"x":0.11094824394050207,"y":0.8506032035438524},{"x":-0.11916663238053715,"y":0.8506032035438524}]],[1],7,[null],"",[1]],[0,0.7527631594133506,-2.304687196372367,-1.4835298641951802,".character#Character , .flesh","arm_right",45,["#999999"],["#000"],[0],false,true,[[{"x":-0.13560340926061798,"y":-0.6862354347431072},{"x":0.14382179770064596,"y":-0.7026722116231809},{"x":0.12738502082057224,"y":0.6944538231831459},{"x":-0.13560340926061798,"y":0.6944538231831459}]],[1],7,[null],"",[1]],[0,0.683371625171598,-5.3883060684165365,0,".character#Character","eye_right",46,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],7,[7.534037070968986],"",[1]],[1,20.670832755342534,-162.1840641862462,0,"","",47,"Normal_Eye0000",46,0.5611519909321366,1.2636024235635333,0,null,"#FFFFFF",1,1,1,0,0,0],[2,20.460933630581174,-161.1890845105542,0,".character#Character","eye_right_joint",48,46,27,0,false,false,1,10,true,0,0,0,0,0,0],[1,-8.643090724728314,-92.07726640985842,-0.5235987755982988,"","",49,"Normal_Shoulder0000",44,0.5731017503262358,-0.16063012257496162,0,true,"#FFFFFF",1,1,1,0,0,0],[1,22.830224766912007,-69.30613785279243,-1.4835298641951802,"","",50,"Normal_Arm0000",45,0.29760652045521085,-0.8937510689744023,0,true,"#FFFFFF",1,1,1,0,0,0],[2,4.013121650823555,-70.4481906174575,0,".character#Character","arm_right_joint",51,45,44,0,false,false,1,10,true,152,0,0,0,0,0],[0,1.599586444410385,-2.1748334470051938,-1.7453292519943295,".character#Character , .flesh","hand_right",52,["#999999"],["#000"],[0],false,true,[[{"x":0,"y":0},{"x":0,"y":0}]],[1],7,[7.512582183874799],"",[1]],[1,47.88581667390657,-63.45036855104893,-1.7453292519943295,"","",53,"Normal_Hand0000",52,1.7975185021906417,2.9104087855451417,0,true,"#FFFFFF",1,1,1,0,0,0],[2,40.60774150707956,-68.16176882033321,0,".character#Character","hand_right_joint",54,52,45,0,false,false,1,10,true,60,-60,0,0,0,0],[2,-13.360572541777511,-113.85816826551492,0,".character#Character","shoulder_left_joint",55,14,28,0,false,false,1,10,true,180,-19,0,0,0,0],[2,-18.865442435977787,-109.24355426208889,0,".character#Character","shoulder_right_joint",56,44,28,0,false,false,1,10,true,180,-19,0,0,0,0],[2,-0.2333468739499165,-162.18153878296124,0,".character#Character","eye_left_joint",57,35,27,0,false,false,1,10,true,0,0,0,0,0,0],[2,-40.594329049141884,-140.9742157988074,0,".character#Character","neck_joint",58,28,27,2,false,false,1,10,false,0,0,0.25,3,0,0],[2,-43.145790681332336,-40.31419252013024,0,".character#Character","belly_joint",59,28,26,0,false,false,1,10,true,10,-10,0,0,0,0],[2,-41.87349782621441,-28.015361587328265,0,".character#Character","thigh_right_joint",60,33,26,0,false,false,1,10,true,142,-16,0,0,0,0],[2,-31.19444326659173,54.642725801018486,0,"","",61,7,10,0,false,false,1,10,true,45,-45,0,0,0,0],[2,79.7601228859024,24.740212387964508,0,".vehicle","front_spring1",62,7,9,2,false,true,5000,-10,true,0,0,0,2,40,0],[2,103.8938315323916,19.252522356539213,0,".vehicle","front_spring2",63,7,9,2,false,false,1,10,false,0,0,0,2,0,0],[2,94.49502540122117,19.858896945646972,2.7234117648119525,".vehicle","front_slide",64,7,9,1,false,true,1,10,true,0,0,0,0,50,0],[2,-110.44269220831998,8.807303580084904,0,".vehicle","back_spring",65,7,10,2,false,false,1,10,false,0,0,0,6,0,0],[2,-50.69932211745928,-34.036787455025845,0,".character#Character","sit_joint",66,26,7,2,false,false,1,10,false,0,0,0.5,10,0,0],[2,-7.144529898559783,67.79347486538028,0,".character#Character","pedal_right_joint",67,40,7,0,false,false,1,10,false,0,0,0.5,6,0,0],[2,9.031819806731594,68.02131077672246,0,".character#Character","pedal_left_joint",68,22,7,0,false,false,1,10,false,0,0,0.5,6,0,0],[2,61.88975123810624,-70.73075923063604,0,".character#Character","grip_left_joint",69,7,19,0,false,false,1,10,false,0,0,0,0,0,0],[2,47.53608882355196,-66.17404100379338,0,".character#Character","grip_right_joint",70,7,52,0,false,false,1,10,false,0,0,0,0,0,0],[2,23.38548222128592,-49.76985538715984,0,".character#Character","back_joint",71,28,7,2,false,false,1,10,false,0,0,0.2,4,0,0],[2,115,80,0,".vehicle","engine2",72,1,9,0,false,false,100,10,false,0,0,0,0,0,0],[2,-128,80,0,".vehicle","engine1",73,0,10,0,false,true,100,10,false,0,0,0,0,0,0]]}',
    class: DirtBike,
    library: PrefabManager.LIBRARY_ADMIN,
}
