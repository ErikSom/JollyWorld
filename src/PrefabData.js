import { Box2D } from "../libs/Box2D";
import { game } from "./Game";

let character1 = new function(){
    this.settings = new function(){
        this._options = {};
        this.showVehicle = false;
        this.skin = "skin1";
        this._options["skin"] = ["skin1", "skin2", "skin3"];
        this.speed = 10;
        this._options["speed"] = {min:0, max:10, step:0.1};
        this.skin_options
    }
    const TIME_EYES_CLOSE = 3000;
    const TIME_EYES_OPEN = 3100;
    const timerReady = function(timer, target){ return (timer < target && timer+game.editor.deltaTime >= target) ?  true : false };


    this.init = function(target){
        target.eyesTimer = 0.0;
        target.lookupObject = game.editor.lookupGroups[target.prefabName+"_"+target.instanceID];

        var i;
        for(i=0; i<target.lookupObject.flesh._bodies.length; i++){
            target.lookupObject.flesh._bodies[i].isFlesh = true;

            var texture = target.lookupObject.flesh._bodies[i].myTexture;
            //fix gore for Skin2, Skin3 etc

            var fleshName = texture.data.textureName.split('0000')[0];
            if(fleshName.indexOf('Head')>0) fleshName = "Skin1_Head";
            var sprite = new PIXI.Sprite(PIXI.Texture.fromFrame(fleshName+"_Flesh0000"));
            texture.addChildAt(sprite, 0);

        }
    }
    this.update = function(target){
        if(timerReady(target.eyesTimer, TIME_EYES_CLOSE)){
            target.lookupObject.eye_left.myTexture.texture = PIXI.Texture.fromFrame(target.lookupObject.eye_left.myTexture.data.textureName.replace("0000","_Closed0000"));
            target.lookupObject.eye_right.myTexture.texture = PIXI.Texture.fromFrame(target.lookupObject.eye_left.myTexture.data.textureName.replace("0000","_Closed0000"));
        }else if(timerReady(target.eyesTimer, TIME_EYES_OPEN)){
            target.lookupObject.eye_left.myTexture.texture = PIXI.Texture.fromFrame(target.lookupObject.eye_left.myTexture.data.textureName);
            target.lookupObject.eye_right.myTexture.texture = PIXI.Texture.fromFrame(target.lookupObject.eye_right.myTexture.data.textureName);
            target.eyesTimer = -game.editor.deltaTime;
        }

        target.eyesTimer += game.editor.deltaTime;
    }
    this.set = function(target, param){
    }

    this.contactListener = new Box2D.Dynamics.b2ContactListener();
	this.contactListener.BeginContact = function (contact, target) {
	}
	this.contactListener.EndContact = function (contact, target) {
	}
	this.contactListener.PreSolve = function (contact, oldManifold, target) {
	}
	this.contactListener.PostSolve = function (contact, impulse, target) {
        var bodies = [contact.GetFixtureA().GetBody(), contact.GetFixtureB().GetBody()];
        var body;

        for(var i = 0; i<bodies.length; i++){
            body = bodies[i];
            if(body == target.lookupObject["head"]){
                var force = 0;
                for(var j = 0; j<impulse.normalImpulses.length; j++) force = Math.max(force, impulse.normalImpulses[j]);
                if(force > 8){
                    if(target.lookupObject["eye_right_joint"]){
                        game.world.DestroyJoint(target.lookupObject["eye_right_joint"]);
                        target.lookupObject["eye_right_joint"] = undefined;
                    }
                }

            }
        }

    }
}

let vain = new function(){
    this.init = function(target){
        //swap childs
    }
}

export var prefabs = {
    character1:{
        json:'{"objects":[[0,-14.15479571521446,-0.20601457546639562,0,"__character","belly",0,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,0,14.181497764354457,"tile_03"],[0,-15.587477652563344,3.0917373915784503,0,"__vehicle","wheel_back",1,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,7,55.342622382700604,"tile_03"],[0,-12.706222198887717,-2.277293681725032,-0.7679448708775047,"__character , .flesh","shoulder_left",2,"#999999","#000",1,false,true,[{"x":-0.18491373990083915,"y":-0.8588215919838902},{"x":0.19313212834087423,"y":-0.8423848151038147},{"x":0.11094824394050207,"y":0.8506032035438524},{"x":-0.11916663238053715,"y":0.8506032035438524}],1,7,null,"tile_03"],[0,-13.03584481513996,3.415442212226376,0,"__vehicle","pedal",3,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,7,15.695946924915829,"tile_03"],[0,-12.66910346558406,1.7711747161382954,0,"__vehicle","frame",4,"#999999","#000",1,false,true,[{"x":-1.866666666666669,"y":-1.666666666666667},{"x":1.966666666666665,"y":-2.7666666666666666},{"x":3.066666666666663,"y":1.299999999999999},{"x":-0.23333333333333428,"y":1.7666666666666657},{"x":-2.9333333333333353,"y":1.3666666666666671}],1,7,null,"tile_03"],[0,-9.635938566021816,3.0622425654175935,0,"__vehicle","wheel_front",5,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,7,54.82895314162905,"tile_03"],[0,-11.468806183808242,-1.609188225246529,-1.4660765716752366,"__character , .flesh","arm_left",6,"#999999","#000",1,false,true,[{"x":-0.13560340926061798,"y":-0.6862354347431072},{"x":0.14382179770064596,"y":-0.7026722116231809},{"x":0.12738502082057224,"y":0.6944538231831459},{"x":-0.13560340926061798,"y":0.6944538231831459}],1,7,null,"tile_03"],[1,-380.7160443489716,-68.645859238965,-0.7679448708775047,"","",7,"Skin1_Shoulder0000",2,0.5731017503262358,-0.16063012257496162,0,true],[1,-343.81400444274186,-48.436827005807,-1.4660765716752366,"","",8,"Skin1_Arm0000",6,0.29760652045521085,-0.8937510689744023,0,true],[2,-362.58348627115765,-50.266620396764175,0,"__character","arm_left_joint",6,2,0,false,false,1,10,true,152,0,0,0],[0,-10.568170575135504,-1.3468220706618923,-1.5009831567151235,"__character , .flesh","hand_left",10,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,7,7.512582183874799,"tile_03"],[1,-317.5780321777745,-38.68795758796856,-1.5009831567151235,"","",11,"Skin1_Hand0000",10,1.7975185021906417,2.9104087855451417,0,true],[2,-323.5226784394827,-44.82853576963867,0,"__character","hand_left_joint",10,6,0,false,false,1,10,true,60,-60,0,0],[0,-13.225480609179147,0.5365243275043184,-0.9075712110370522,"__character , .flesh","thigh_left",13,"#999999","#000",1,false,true,[{"x":-0.20241022695050503,"y":-1.031328299223996},{"x":0.1959845054600109,"y":-1.0441797422049808},{"x":0.17028161949803788,"y":1.0377540207144893},{"x":-0.16385589800755085,"y":1.0377540207144893}],1,7,null,"tile_03"],[0,-12.571217023868181,2.0289178508961574,0.24434609527920528,"__character , .flesh","leg_left",14,"#999999","#000",1,false,true,[{"x":-0.16064303726230378,"y":-0.9124524516498909},{"x":0.16064303726230378,"y":-0.9253038946308756},{"x":0.08353437937639896,"y":0.9124524516498909},{"x":-0.08353437937639896,"y":0.9253038946308738}],1,7,null,"tile_03"],[1,-396.71829100946456,16.506359197979464,-0.9075712110370522,"","",15,"Skin1_Thigh0000",13,0.4132120599733628,-2.3665034033387577,0,true],[0,-12.637350790203799,3.1040822873389744,0.10471975511965961,"__character , .flesh","feet_right",16,"#999999","#000",1,false,true,[{"x":-0.3532003169100655,"y":-0.2334193398709985},{"x":0.3593429311171974,"y":0},{"x":0.3593429311171974,"y":0.12285228414263472},{"x":-0.3654855453243293,"y":0.11056705572837089}],1,7,null,"tile_03"],[1,-377.329401391029,60.819442480124174,0.24434609527920528,"","",17,"Skin1_Leg0000",14,0.19879575861250487,-3.1415926535889356,0,true],[2,-373.91980805033177,34.84420049102433,0,"__character","leg_left_joint",14,13,0,false,false,1,10,true,0,-149,0,0],[1,-378.44624770185254,91.76572057838662,0.10471975511965961,"","",19,"Skin1_Feet0000",16,1.515062169946712,1.2142877670861258,0,true],[1,-390.7185753038024,102.41178466834725,0,"","",20,"Bicycle_Pedals0000",3,0.36046441148776853,0.1433105210885714,0,null],[1,-289.08363344783385,91.86727696252792,0,"","",21,"Bicycle_WheelFront0000",5,0.005476467179391875,-3.141592653569034,0,null],[1,-467.04193017482606,92.21545703335131,0,"","",22,"Bicycle_WheelBack0000",1,0.7919583819819808,0.7445522010315536,0,null],[1,-379.0731039675219,33.13524148414858,0,"","",23,"Bicycle_Body0000",4,20.024984394501065,1.5208379310729603,0,null],[2,-384.5507050447086,87.37277584095949,0,"__character","feet_left_joint",16,14,0,false,false,1,10,true,60,-60,0,0],[2,-467.4842532404466,91.4420717514557,0,"__vehicle","engine1",1,4,0,false,true,1000,20,false,0,0,0,0],[2,-391.3449746037868,102.19192260910702,0,"__vehicle","pedal_engine",3,4,0,false,false,200,-10,false,0,0,0,0],[2,-289.1649592377489,91.71118831367843,0,"__vehicle","engine2",5,4,0,false,true,1000,20,false,0,0,0,0],[0,-12.842470529097447,-4.356680473333219,0,"__character , .flesh","head",28,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,7,30.393075689479595,"tile_03"],[0,-13.562343930970824,-1.9211056898254968,0.3490658503988659,"__character , .flesh","body",29,"#999999","#000",1,false,true,[{"x":-0.5373137876370677,"y":1.2023497051222813},{"x":-0.4316127146592841,"y":-1.3697097373371037},{"x":-0.1497431867185277,"y":-1.82774772024083},{"x":0.1321263412222251,"y":-1.7925140292482356},{"x":0.5549306331333597,"y":-1.1230739003889436},{"x":0.5549306331333597,"y":1.308050778100065},{"x":0.09689265022963056,"y":1.801322451996385},{"x":-0.2202105687037168,"y":1.801322451996385}],1,7,null,"tile_03"],[1,-421.1342207890703,-14.192199759023456,0.2,"","",30,"Skin1_Belly0000",0,8.746770037203438,1.1579140652818587,-0.2,false],[1,-404.7400028354393,-61.216582791160576,0.3490658503988659,"","",31,"Skin1_Core0000",29,4.16882293351236,1.3835014335302833,0,true],[1,-383.1600944133685,-132.81443565955223,0,"","",32,"Skin1_Head_Idle0000",28,2.989677819250855,0.785398163397623,0,true],[2,-388.6944902542223,-102.80460570208368,0,"__character","head_joint",28,29,0,false,false,1,10,true,58,-64,0,0],[0,-13.641381453147464,0.9190024212953946,-0.45378560551852554,"__character , .flesh","thigh_right",34,"#999999","#000",1,false,true,[{"x":-0.20241022695050503,"y":-1.031328299223996},{"x":0.1959845054600109,"y":-1.0441797422049808},{"x":0.17028161949803788,"y":1.0377540207144893},{"x":-0.16385589800755085,"y":1.0377540207144893}],1,7,null,"tile_03"],[0,-13.320185278126573,2.730751467419776,0.17453292519943295,"__character , .flesh","leg_right",35,"#999999","#000",1,false,true,[{"x":-0.16064303726230378,"y":-0.9124524516498909},{"x":0.16064303726230378,"y":-0.9253038946308756},{"x":0.08353437937639896,"y":0.9124524516498909},{"x":-0.08353437937639896,"y":0.9253038946308738}],1,7,null,"tile_03"],[0,-12.653139079346476,-4.45222602219477,0,"__character","eye_left",36,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,7,7.534037070968986,"tile_03"],[1,-409.37999275153356,27.959364736870047,-0.45378560551852554,"","",37,"Skin1_Thigh0000",34,0.4132120599733628,-2.3665034033387577,0,true],[1,-399.8013339481447,81.88802350138246,0.17453292519943295,"","",38,"Skin1_Leg0000",35,0.19879575861250487,-3.1415926535889356,0,true],[1,-379.42448838019965,-134.1016627995932,0,"","",39,"Skin1_Eye0000",36,0.5611519909321366,1.2636024235635333,0,null],[2,-395.6046037718331,55.96284374603814,0,"__character","leg_right_joint",35,34,0,false,false,1,10,true,0,-149,0,0],[0,-13.268007748094366,3.800669590829147,0,"__character , .flesh","feet_right",41,"#999999","#000",1,false,true,[{"x":-0.3532003169100655,"y":-0.2334193398709985},{"x":0.3593429311171974,"y":0},{"x":0.3593429311171974,"y":0.12285228414263472},{"x":-0.3654855453243293,"y":0.11056705572837089}],1,7,null,"tile_03"],[1,-397.51146898092054,112.60029105627989,0,"","",42,"Skin1_Feet0000",41,1.515062169946712,1.2142877670861258,0,true],[2,-404.30243173046574,108.76090925482245,0,"__character","feet_right_joint",41,35,0,false,false,1,10,true,60,-60,0,0],[0,-12.957985574982715,-2.116475866987431,-0.5235987755982988,"__character , .flesh","shoulder_right",44,"#999999","#000",1,false,true,[{"x":-0.18491373990083915,"y":-0.8588215919838902},{"x":0.19313212834087423,"y":-0.8423848151038147},{"x":0.11094824394050207,"y":0.8506032035438524},{"x":-0.11916663238053715,"y":0.8506032035438524}],1,7,null,"tile_03"],[0,-11.899260644516255,-1.3587035285866276,-1.4835298641951802,"__character , .flesh","arm_right",45,"#999999","#000",1,false,true,[{"x":-0.13560340926061798,"y":-0.6862354347431072},{"x":0.14382179770064596,"y":-0.7026722116231809},{"x":0.12738502082057224,"y":0.6944538231831459},{"x":-0.13560340926061798,"y":0.6944538231831459}],1,7,null,"tile_03"],[1,-388.20380484261653,-63.69775637628599,-0.5235987755982988,"","",46,"Skin1_Shoulder0000",44,0.5731017503262358,-0.16063012257496162,0,true],[1,-356.73048935097614,-40.92662781922026,-1.4835298641951802,"","",47,"Skin1_Arm0000",45,0.29760652045521085,-0.8937510689744023,0,true],[2,-375.5475924670636,-42.06868058388569,0,"__character","arm_right_joint",45,44,0,false,false,1,10,true,152,0,0,0],[0,-11.05243735951922,-1.2288497792194542,-1.7453292519943295,"__character , .flesh","hand_right",49,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,7,7.512582183874799,"tile_03"],[1,-331.6748974439816,-35.070858517476736,-1.7453292519943295,"","",50,"Skin1_Hand0000",49,1.7975185021906417,2.9104087855451417,0,true],[2,-338.9529726108081,-39.782258786761524,0,"__character","hand_right_joint",49,45,0,false,false,1,10,true,60,-60,0,0],[2,-398.42615655386476,-80.86404422851663,0,"__character","shoulder_right_joint",44,29,0,false,false,1,10,true,180,-19,0,0],[2,-379.7940609918371,-133.80202874938874,0,"__character","eye_left_joint",36,28,0,false,false,1,10,true,0,0,0,0],[0,-11.968652178758008,-4.442322400630781,0,"__character","eye_right",54,"#999999","#000",1,false,true,[{"x":0,"y":0},{"x":0,"y":0}],1,7,7.534037070968986,"tile_03"],[1,-358.8898813625456,-133.80455415267352,0,"","",55,"Skin1_Eye0000",54,0.5611519909321366,1.2636024235635333,0,null],[2,-359.09978048730613,-132.8095744769817,0,"__character","eye_right_joint",54,28,0,false,false,1,10,true,0,0,0,0],[2,-392.9212866596645,-85.47865823194277,0,"__character","shoulder_left_joint",2,29,0,false,false,1,10,true,180,-19,0,0],[2,-398.4935509450106,113.74126702226283,0,"__character","pedal_right_joint",41,3,0,false,false,1,10,false,0,0,0,0],[2,-380.865590946009,92.6312408506183,0,"__character","pedal_left_joint",16,3,0,false,false,1,10,false,0,0,0,0],[2,-315.7913682700471,-40.41550229109624,0,"__character","grip_left_joint",4,10,0,false,false,1,10,false,0,0,0,0],[2,-328.52394098431125,-34.80283447309619,0,"__character","grip_right_joint",4,49,0,false,false,1,10,false,0,0,0,0],[2,-420.15504316702885,-112.59470576523498,0,"__character","neck_joint",29,28,2,false,false,1,10,false,0,0,0.25,3],[2,-476.0558450486295,-149.53615887833575,0,"__character","back_joint",4,29,2,false,false,1,10,false,0,0,0.25,4],[2,-422.70650479921926,-11.93468248655901,0,"__character","core_joint",29,0,0,false,false,1,10,true,10,-10,0,0],[2,-426.94748098294406,0.36414844624303616,0,"__character","sit_joint",4,0,2,false,false,1,10,false,0,0,0.5,10],[2,-421.4342119441014,0.3641484462430608,0,"__character","thigh_right_joint",34,0,0,false,false,1,10,true,142,-16,0,0],[2,-416.34504052363036,-3.8768277374817983,0,"__character","thigh_left_joint",13,0,0,false,false,1,10,true,142,-16,0,0]]}',
        settings:character1.settings,
        init:character1.init,
        update:character1.update,
        set:character1.set,
        contactListener:character1.contactListener
    },
    vain:{
        json:'{"objects":[[0,0.003154367820629632,-0.07136374712007679,0,"","part1",0,"#890808","#630606",1,false,true,[{"x":0.028477641735626946,"y":-0.09142821820385016},{"x":0.02248234873865229,"y":0.08843057170536373},{"x":-0.025479995237137842,"y":0.08843057170536373},{"x":-0.025479995237137842,"y":-0.08543292520687551}],1,0,null,""],[0,-0.048945224052909055,-0.21267429024827236,-0.7679448708775056,"","part2",1,"#890808","#6b0909",1,false,true,[{"x":0.028477641735626946,"y":-0.09142821820385016},{"x":0.02248234873865229,"y":0.08843057170536373},{"x":-0.025479995237137842,"y":0.08843057170536373},{"x":-0.025479995237137842,"y":-0.08543292520687551}],1,0,null,""],[0,0.003347876330606313,-0.06824396020197912,0,"","part4",2,"#890808","#660505",1,false,true,[{"x":0.028477641735626946,"y":-0.09142821820385016},{"x":0.02248234873865229,"y":0.08843057170536373},{"x":-0.025479995237137842,"y":0.08843057170536373},{"x":-0.025479995237137842,"y":-0.08543292520687551}],1,0,null,""],[0,-0.05108297945339905,-0.22011994128041493,2.4260076602721177,"","part3",3,"#890808","#600303",1,false,true,[{"x":0.028477641735626946,"y":-0.09142821820385016},{"x":0.02248234873865229,"y":0.08843057170536373},{"x":-0.025479995237137842,"y":0.08843057170536373},{"x":-0.025479995237137842,"y":-0.08543292520687551}],1,0,null,""],[2,0.2604863299759831,-4.6079468327877935,0,"","part1_joint",1,0,0,false,false,1,10,false,0,0,0,0],[2,-3.3082859975393926,-8.384121948799184,0,"","part2_joint",3,1,0,false,false,1,10,false,0,0,0,0],[2,0.2729742921443762,-4.3639657228591675,0,"","part3_joint",2,3,0,false,false,1,10,false,0,0,0,0]]}',
        settings:undefined,
        init:vain.init,
        update:undefined,
        set:undefined
    }
}

