import { Key } from "../../libs/Key";
import * as MobileController from './MobileController'

let keyInput = [];
let gameFrame = 0;
let recording = true;
let replaying = false;

// export const registerKey = keyEvent => {
// 	if(!['keydown', 'keyup'].includes(keyEvent.type)) return;

// 	if(recording){
// 		console.log("Check");
// 		const down = keyEvent.type === 'keydown';
// 		if((down && !Key._down[keyEvent.keyCode]) || !down){
// 			keyInput.push([gameFrame, +down, keyEvent.keyCode]);
// 		}
// 	}
// }

export const startRecording = ()=>{
	keyInput.length = 0;
	gameFrame = 0;
	recording = true;
}

export const stopRecording = ()=>{
	recording = false;
	console.log("*************** INPUT RECORDING ***************");
	console.log(JSON.stringify(keyInput));
	console.log("*************** END RECORDING *****************");
}

export const startReplay = ()=>{
	recording = false;
	replaying = true;

	keyInput = JSON.parse('[[48,1,"37"],[70,0,"37"],[75,1,"39"],[93,0,"39"],[95,1,"38"],[201,1,"37"],[214,0,"37"],[225,1,"39"],[232,0,"39"],[235,0,"38"],[243,1,"38"],[249,1,"37"],[285,0,"37"],[295,0,"38"],[302,1,"37"],[316,0,"37"],[322,1,"39"],[357,0,"39"],[369,1,"39"],[379,1,"38"],[386,0,"39"],[402,1,"39"],[429,0,"39"],[501,1,"37"],[502,0,"38"],[518,0,"37"],[523,1,"39"],[528,1,"38"],[531,0,"39"],[548,1,"37"],[556,0,"38"],[563,0,"37"],[583,1,"38"],[651,1,"37"],[675,0,"37"],[681,1,"39"],[687,0,"39"],[689,0,"38"],[703,1,"39"],[731,0,"39"],[739,1,"39"],[747,0,"39"],[751,1,"38"],[821,1,"39"],[833,0,"39"],[841,1,"37"],[856,0,"37"],[874,1,"37"],[888,0,"37"],[921,1,"37"],[954,0,"37"],[959,1,"37"],[967,1,"39"],[967,0,"37"],[1007,0,"39"],[1023,1,"37"],[1064,1,"39"],[1064,0,"37"],[1091,1,"37"],[1091,0,"39"],[1113,0,"37"],[1115,1,"39"],[1140,0,"39"],[1153,1,"39"],[1164,0,"39"],[1170,1,"37"],[1180,0,"37"],[1251,1,"37"],[1272,0,"37"],[1287,1,"37"],[1295,1,"39"],[1296,0,"37"],[1303,0,"39"],[1304,1,"37"],[1331,0,"37"],[1340,1,"37"],[1378,0,"37"],[1381,1,"37"],[1386,0,"37"],[1389,1,"39"],[1417,0,"39"],[1418,1,"37"],[1440,0,"37"],[1446,1,"39"],[1465,0,"39"],[1466,1,"37"],[1491,0,"37"],[1494,1,"39"],[1512,0,"39"],[1514,1,"37"],[1540,0,"37"],[1545,1,"39"],[1564,1,"37"],[1565,0,"39"],[1600,0,"37"],[1604,1,"39"],[1633,1,"37"],[1634,0,"39"],[1664,1,"39"],[1664,0,"37"],[1689,0,"39"],[1697,1,"39"],[1709,0,"39"],[1715,1,"37"],[1744,1,"39"],[1744,0,"37"],[1763,0,"39"],[1765,1,"37"],[1766,0,"37"],[1769,1,"39"],[1787,1,"37"],[1787,0,"39"],[1793,0,"37"],[1794,1,"39"],[1798,0,"39"],[1799,1,"37"],[1819,0,"37"],[1820,1,"39"],[1856,1,"37"],[1856,0,"39"],[1870,0,"37"],[1873,1,"39"],[1901,1,"37"],[1901,0,"39"],[1934,0,"37"],[1936,1,"39"],[1960,0,"39"],[1963,1,"37"],[1984,0,"37"],[1991,1,"39"],[1996,0,"39"],[2009,1,"39"],[2022,0,"39"],[2023,1,"37"],[2044,0,"37"],[2049,1,"39"],[2065,1,"37"],[2065,0,"39"],[2092,0,"37"],[2093,1,"39"],[2130,0,"39"],[2137,1,"39"],[2141,0,"39"],[2143,1,"37"],[2177,1,"39"],[2178,0,"37"],[2217,1,"37"],[2217,0,"39"],[2237,0,"37"],[2237,0,"38"],[2240,1,"39"],[2249,0,"39"],[2259,1,"39"],[2263,1,"38"],[2291,0,"39"],[2293,0,"38"],[2356,1,"32"],[2361,0,"32"],[2386,1,"38"],[2397,1,"39"],[2434,0,"38"],[2437,0,"39"],[2448,1,"37"],[2463,0,"37"],[2465,1,"39"],[2470,1,"38"],[2474,0,"39"],[2477,1,"37"],[2482,0,"37"],[2499,1,"39"],[2521,0,"39"],[2530,1,"32"],[2535,0,"32"],[2537,1,"37"],[2547,0,"37"],[2557,1,"32"],[2561,0,"32"],[2563,1,"39"],[2573,0,"39"],[2590,1,"37"],[2617,0,"37"],[2617,0,"38"],[2630,1,"39"],[2644,0,"39"],[2670,1,"39"],[2695,0,"39"],[2801,1,"27"]]');
}

export const update = ()=>{
	gameFrame++;

	if(recording){
		for( let key in Key._pressed){
			if(Key._down[key]) keyInput.push([gameFrame, 1, key]);
		}
		for( let key in Key._released){
			if(Key._released[key]) keyInput.push([gameFrame, 0, key]);
		}
	}
	if(replaying){
		while(keyInput.length > 0 && keyInput[0][0] === gameFrame){
			const [_frame, down, keyCode] = keyInput[0];
			if(down){
				Key._down[keyCode] = true;
				Key._pressed[keyCode] = true;
			}else{
				Key._down[keyCode] = false;
				Key._released[keyCode] = true;
			}
			keyInput.shift();
		}
	}
}
